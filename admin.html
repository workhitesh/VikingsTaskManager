<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div id="webappDas">
        <div id="adminpanel">
            <h1>Admin Panel</h1>

            <div id="taskCreate">
                <label for="taskName">Task Name</label>
                <input type="text" name="taskName" id="taskNameid">
                <label for="taskDes">Task Description</label>
                <textarea class="input" size="300" name="taskDes" id="taskDescription"></textarea>
                <label for="taskName">Start Date</label>
                <input type="date" name="startDate" id="startDateid">
                <label for="taskName">End Date</label>
                <input type="date" name="endDate" id="endDateid">
                <label for="cars">Choose a user:</label>

                <select name="users" id="users">
                </select><br>

                <label for="hrRate">Hourly Rate</label>
                <input type="text" name="hrRate" id="hrRate">

                <button id="btnCreateTask">Create Task</button>
            </div>

            <div style="margin-top: 50px;"">
                <table>
                    <thead>
                        <th>Task Name</th>
                        <th>Task Description</th>
                        <th>Task start date</th>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Task1</td>
                            <td> Description</td>
                            <td>08 june </td>
                        </tr>
                    </tbody>
                    
                </table>
            </div>
        </div>
    </div>


    <script type="module">

        import { initializeApp } from
         'https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js'
    
        // Add Firebase products that you want to use
        import { getFirestore, collection, addDoc, getDocs, 
            updateDoc, doc , where, query } from
             'https://www.gstatic.com/firebasejs/9.8.3/firebase-firestore.js'
    
        const firebaseConfig = {
          apiKey: "AIzaSyCfLAML4A9M5yBf5LyH14mWYBU62y6SLcA",
          authDomain: "vikingstaskmanager.firebaseapp.com",
          projectId: "vikingstaskmanager",
          storageBucket: "vikingstaskmanager.appspot.com",
          messagingSenderId: "282303572666",
          appId: "1:282303572666:web:16bdd6315143d148aab083",
          measurementId: "G-L0BDK31DL6",
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getFirestore(app);

        var allUsersArr = [];
        getAllUsers();
        
        async function getAllUsers() {
            const qA = await getDocs(collection(database, "users"));
            qA.forEach((element) => {
                let user = new Object();
                user.id = element.id;
                user.email = element.data()["email"];
                if (element.data()["isAdmin"] == false) {
                    allUsersArr.push(user);
                }
            });
            updateDropDownOptions();
    }

    let dropDown = document.getElementById('users');

    function updateDropDownOptions(){
        for (let index = 0; index < allUsersArr.length; index++) {
            const element = allUsersArr[index];
            var option = document.createElement("option");
            option.text = element.email;
            dropDown.add(option);
        }
    };

    let btnCreateTask = document.getElementById('btnCreateTask');
    btnCreateTask.onclick = async function(){
        let name = document.getElementById('taskNameid').value;
        let description = document.getElementById('taskDescription').value;
        let startDate = document.getElementById('startDateid').value;
        let endDate = document.getElementById('endDateid').value;
        let userId = allUsersArr[dropDown.selectedIndex].id;
        let hrlyRate = document.getElementById('hrRate').value; 
        let status = 0;
        let totalHours = 0;

        // create task
        // Add a new document with a generated id.
        const docRef = await addDoc(collection(database, "tasks"), {
            description: description,
            name:name,
            startDate:Date.parse(startDate),
            endDate:Date.parse(endDate),
            assignedUserId:userId,
            hourlyRate:parseInt(hrlyRate,10),
            status:status,
            totalHours:totalHours,
            ownerId:""
        });
    };

      </script>

</body>

</html>